"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.registro=registro,exports.login=login,exports.perfil=perfil;var _usuarioModel=require("../models/usuarioModel.js"),_bcryptjs=_interopRequireDefault(require("bcryptjs")),_jsonwebtoken=_interopRequireDefault(require("jsonwebtoken"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(t,!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function registro(r,t){var n,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,console.log(n),e.prev=2,o=_bcryptjs.default.hashSync(n.password,10),e.next=6,regeneratorRuntime.awrap(_usuarioModel.Usuario.create(_objectSpread({},n,{password:o})));case 6:e.sent,t.status(201).json({message:"Usuario creado exitosamente"}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),t.status(500).json({message:"Error al crear el usuario",content:e.t0.message});case 13:case"end":return e.stop()}},null,null,[[2,10]])}function login(r,t){var n,o,s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,e.next=3,regeneratorRuntime.awrap(_usuarioModel.Usuario.findOne({email:n.email}));case 3:if(o=e.sent){e.next=6;break}return e.abrupt("return",t.status(404).json({message:"El usuario no existe"}));case 6:_bcryptjs.default.compareSync(n.password,o.password)?(s={jti:o._id,nombre:o.nombre},a=_jsonwebtoken.default.sign(s,process.env.JWT_SECRET,{expiresIn:"1h"}),t.json({message:"Bienvenido",content:a})):t.json({message:"Error al ingresar, la contraseÃ±a no es valida"});case 7:case"end":return e.stop()}})}function perfil(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(r.user),e.next=3,regeneratorRuntime.awrap(_usuarioModel.Usuario.aggregate().lookup({from:"agendas",localField:"agendas",foreignField:"_id",as:"agendas"}).match({_id:r.user._id}).project("-password"));case 3:n=e.sent,t.json({content:n});case 5:case"end":return e.stop()}})}
//# sourceMappingURL=usuarioController.min.js.map
